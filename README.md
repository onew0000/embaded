# EMG 근육 긴장도 측정 및 피드백 시스템

이 시스템은 근전도(EMG) 센서를 사용하여 근육의 긴장도를 실시간으로 측정하고, 분석하여 사용자에게 적절한 피드백을 제공합니다.

## 시스템 구성

### 1. 센서 측정 단계
- **근전도(EMG) 센서**: 근육에서 발생하는 전기 신호를 감지
- **HC-06 블루투스 모듈**: 측정된 데이터를 스마트폰으로 전송

### 2. 데이터 정제 단계
- **칼만 필터**: 노이즈 제거 및 신호 안정화
- **저역통과 필터**: 고주파 노이즈 제거
- **이동평균 필터**: 신호 스무딩

### 3. 긴장도 판정 단계
- **긍정 판정**: 기준값을 초과하는 경우 (과도한 긴장)
- **부정 판정**: 기준값을 미달하는 경우 (부족한 긴장)
- **지속 시간 조건**: 일정 시간 이상 상태가 유지되어야 판정 확정

### 4. 피드백 제공 단계
- **시각적 피드백**: Pygame을 사용한 그래픽 인터페이스
- **색상 코딩**: 빨간색(높은 긴장도), 파란색(낮은 긴장도)
- **조언 메시지**: 상황에 맞는 구체적인 안내

## 설치 방법

### 1. 의존성 패키지 설치
```bash
pip install -r requirements.txt
```

### 2. 하드웨어 연결
- EMG 센서를 Arduino나 ESP32에 연결
- HC-06 블루투스 모듈을 시리얼 포트에 연결
- 센서를 측정하고자 하는 근육 부위에 부착

### 3. 포트 설정
- `serial.py`에서 시리얼 포트 설정 (`/dev/ttyUSB0`)
- `app.py`에서 블루투스 포트 설정 (`/dev/rfcomm0`)

## 사용 방법

### 1. 기본 실행
```bash
python app.py
```

### 2. 개별 모듈 테스트
```bash
# 시리얼 통신 테스트
python serial.py

# 메인 애플리케이션 실행
python app.py
```

### 3. 설정 조정
- `TensionAnalyzer` 클래스에서 `threshold` 값 조정 (기본값: 100.0)
- `duration_threshold` 값 조정 (기본값: 2.0초)
- `EMGFilter` 클래스에서 필터 파라미터 조정

## 주요 기능

### EMGFilter 클래스
- **칼만 필터**: `kalman_filter()` 메서드
- **저역통과 필터**: `low_pass_filter()` 메서드
- **이동평균 필터**: `moving_average_filter()` 메서드

### TensionAnalyzer 클래스
- **긴장도 분석**: `analyze_tension()` 메서드
- **지속 시간 추적**: 긴장 상태의 지속 시간 모니터링
- **판정 결과**: `TensionResult` 데이터 클래스로 결과 반환

### FeedbackProvider 클래스
- **시각적 피드백**: Pygame 기반 그래픽 인터페이스
- **색상 코딩**: 긴장도 수준에 따른 색상 변경
- **자동 종료**: 5초 후 자동으로 피드백 창 닫힘

## 파일 구조

```
embaded/
├── serial.py          # 시리얼 통신 및 블루투스 관리
├── app.py             # 메인 애플리케이션 (필터링, 분석, 피드백)
├── requirements.txt   # Python 패키지 의존성
└── README.md         # 이 파일
```

## 하드웨어 요구사항

### 필수 하드웨어
- EMG 센서 (예: Myoware EMG Sensor)
- HC-06 블루투스 모듈
- Arduino 또는 ESP32 (센서 데이터 처리용)
- 전극 패드 및 케이블

### 권장 사양
- 8채널 이상의 EMG 센서
- 고속 블루투스 모듈 (HC-05 또는 HC-06)
- 마이크로컨트롤러: ESP32 (WiFi/Bluetooth 내장)

## 문제 해결

### 일반적인 문제들

1. **시리얼 포트 연결 실패**
   - 포트 이름 확인 (`/dev/ttyUSB0`, `/dev/ttyACM0` 등)
   - 권한 문제 해결: `sudo chmod 666 /dev/ttyUSB0`

2. **블루투스 연결 실패**
   - 블루투스 모듈 페어링 확인
   - 포트 설정 확인: `sudo rfcomm bind 0 [MAC_ADDRESS]`

3. **데이터 수신 안됨**
   - 센서 연결 상태 확인
   - 전극 패드 부착 상태 확인
   - 배터리 상태 확인

### 디버깅 모드
```python
# 상세한 로그 출력
import logging
logging.basicConfig(level=logging.DEBUG)
```

## 라이선스

이 프로젝트는 MIT 라이선스 하에 배포됩니다.

## 기여하기

버그 리포트, 기능 제안, 코드 기여를 환영합니다. GitHub Issues를 통해 연락해주세요. 
